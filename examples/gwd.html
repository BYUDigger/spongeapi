
  <script type="text/javascript" id="gwd-init-code">
    (function() {
	document.body.style.opacity = "0";
	var gwdAd = document.getElementById('gwd-ad');

	var iframeId, iid, handleSetupResponse;
	/**
	* Handles the DOMContentLoaded event. The DOMContentLoaded event is
	* fired when the document has been completely loaded and parsed.
	*/

	function handleDomContentLoaded(event) {
	// This is a good place to show a loading or branding image while
	// the ad loads.
	// Pulling Spongecell ad iid from iframe id
		
	}

	/**
	* Handles the WebComponentsReady event. This event is fired when all
	* custom elements have been registered and upgraded.
	*/
	function handleWebComponentsReady(event) {
		document.body.style.opacity = "";
		// Start the Ad lifecycle.
		iid = window.location.search.slice(1);
		window.spongecell = window.spongecell || {};

		var asset;
		/*

		if (parent == window) // don't wait for spongecell if not in an iframe        
		  return loader.loadManifest(lib.properties.manifest);

		*/

		parent.postMessage(JSON.stringify({
		  type: 'api',
		  topic: 'setup',
		  iid: iid,
		  callback: 'handleSetupResponse'
		}), '*');

		window.addEventListener('message', function(event) {
		  var message = event.data;
		  if (message) {
		    eval(message.callback)(message.data)
		  }
		});
		setTimeout(function() {
		  gwdAd.initAd();
		}, 0);
	}

	/**
	* Handles the event that is dispatched after the Ad has been
	* initialized and before the default page of the Ad is shown.
	*/
	function handleAdInitialized(event) {
	// This marks the end of the polite load phase of the Ad. If a
	// loading image was shown to the user, this is a good place to
	// remove it.
	}



			
	function handleSetupResponse(message) {
		window.spongecell.apiData = message || {};

		parseDynamic();

	}

	function parseDynamic()
	{
		/*

		UPDATE TEXT & IMAGES WITH DYNAMIC ASSETS & PROPERTIES
		MATCHING CLASS NAMES TO SIGNAL PROCESSOR PROPERTIES

		*/
		for (var property in spongecell.apiData.assets) {
	    	var el = document.getElementsByClassName(property);
	    	if(el){
	    		for(var i = 0; i < el.length; i++){
		    		el[i].src = spongecell.apiData.assets[property].src;
		    		el[i].setAttribute('source',spongecell.apiData.assets[property].src);
		    	}
	    	}
		}

		for (var property in spongecell.apiData.properties) {
			var el = document.getElementsByClassName(property);
	    	if(el){
	    		for(var i = 0; i < el.length; i++){
		    		el[i].innerHTML = spongecell.apiData.properties[property].text;
		    	}
	    	}
	    }
	}
			
	  window.addEventListener('DOMContentLoaded',
	    handleDomContentLoaded, false);
	  window.addEventListener('WebComponentsReady',
	    handleWebComponentsReady, false);
	  window.addEventListener('adinitialized',
	    handleAdInitialized, false);
	})();
  </script>
